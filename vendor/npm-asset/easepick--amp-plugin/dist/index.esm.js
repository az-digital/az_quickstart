import{BasePlugin as e}from"@easepick/base-plugin";import{DateTime as t}from"@easepick/datetime";class n extends e{rangePlugin;lockPlugin;priority=10;binds={onView:this.onView.bind(this),onColorScheme:this.onColorScheme.bind(this)};options={dropdown:{months:!1,years:!1,minYear:1950,maxYear:null},darkMode:!0,locale:{resetButton:'<svg xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>'}};matchMedia;getName(){return"AmpPlugin"}onAttach(){this.options.darkMode&&window&&"matchMedia"in window&&(this.matchMedia=window.matchMedia("(prefers-color-scheme: dark)"),this.matchMedia.matches&&(this.picker.ui.container.dataset.theme="dark"),this.matchMedia.addEventListener("change",this.binds.onColorScheme)),this.options.weekNumbers&&this.picker.ui.container.classList.add("week-numbers"),this.picker.on("view",this.binds.onView)}onDetach(){this.options.darkMode&&window&&"matchMedia"in window&&this.matchMedia.removeEventListener("change",this.binds.onColorScheme),this.picker.ui.container.removeAttribute("data-theme"),this.picker.ui.container.classList.remove("week-numbers"),this.picker.off("view",this.binds.onView)}onView(e){this.lockPlugin=this.picker.PluginManager.getInstance("LockPlugin"),this.rangePlugin=this.picker.PluginManager.getInstance("RangePlugin"),this.handleDropdown(e),this.handleResetButton(e),this.handleWeekNumbers(e)}onColorScheme(e){const t=e.matches?"dark":"light";this.picker.ui.container.dataset.theme=t}handleDropdown(e){const{view:n,target:i,date:o,index:s}=e.detail;if("CalendarHeader"===n){const e=i.querySelector(".month-name");if(this.options.dropdown.months){e.childNodes[0].remove();const n=document.createElement("select");n.className="month-name--select month-name--dropdown";for(let e=0;e<12;e+=1){const i=document.createElement("option"),s=new t(new Date(o.getFullYear(),e,2,0,0,0)),a=new t(new Date(o.getFullYear(),e,1,0,0,0));i.value=String(e),i.text=s.toLocaleString(this.picker.options.lang,{month:"long"}),this.lockPlugin&&(i.disabled=this.lockPlugin.options.minDate&&a.isBefore(new t(this.lockPlugin.options.minDate),"month")||this.lockPlugin.options.maxDate&&a.isAfter(new t(this.lockPlugin.options.maxDate),"month")),i.selected=a.getMonth()===o.getMonth(),n.appendChild(i)}n.addEventListener("change",(e=>{const t=e.target;this.picker.calendars[0].setDate(1),this.picker.calendars[0].setMonth(Number(t.value)),this.picker.renderAll()})),e.prepend(n)}if(this.options.dropdown.years){e.childNodes[1].remove();const n=document.createElement("select");n.className="month-name--select";const i=this.options.dropdown.minYear,s=this.options.dropdown.maxYear?this.options.dropdown.maxYear:(new Date).getFullYear();if(o.getFullYear()>s){const e=document.createElement("option");e.value=String(o.getFullYear()),e.text=String(o.getFullYear()),e.selected=!0,e.disabled=!0,n.appendChild(e)}for(let e=s;e>=i;e-=1){const i=document.createElement("option"),s=new t(new Date(e,0,1,0,0,0));i.value=String(e),i.text=String(e),this.lockPlugin&&(i.disabled=this.lockPlugin.options.minDate&&s.isBefore(new t(this.lockPlugin.options.minDate),"year")||this.lockPlugin.options.maxDate&&s.isAfter(new t(this.lockPlugin.options.maxDate),"year")),i.selected=o.getFullYear()===e,n.appendChild(i)}if(o.getFullYear()<i){const e=document.createElement("option");e.value=String(o.getFullYear()),e.text=String(o.getFullYear()),e.selected=!0,e.disabled=!0,n.appendChild(e)}if("asc"===this.options.dropdown.years){const e=Array.prototype.slice.call(n.childNodes).reverse();n.innerHTML="",e.forEach((e=>{e.innerHTML=e.value,n.appendChild(e)}))}n.addEventListener("change",(e=>{const t=e.target;this.picker.calendars[0].setFullYear(Number(t.value)),this.picker.renderAll()})),e.appendChild(n)}}}handleResetButton(e){const{view:t,target:n}=e.detail;if("CalendarHeader"===t&&this.options.resetButton){const e=document.createElement("button");e.className="reset-button unit",e.innerHTML=this.options.locale.resetButton,e.addEventListener("click",(e=>{e.preventDefault();let t=!0;"function"==typeof this.options.resetButton&&(t=this.options.resetButton.call(this)),t&&this.picker.clear()})),n.appendChild(e)}}handleWeekNumbers(e){if(this.options.weekNumbers){const{view:n,target:i}=e.detail;if("CalendarDayNames"===n){const e=document.createElement("div");e.className="wnum-header",e.innerHTML="Wk",i.prepend(e)}"CalendarDays"===n&&[...i.children].forEach(((e,n)=>{if(0===n||n%7==0){let n;if(e.classList.contains("day"))n=new t(e.dataset.time);else{const e=i.querySelector(".day");n=new t(e.dataset.time)}let o=n.getWeek(this.picker.options.firstDay);53===o&&0===n.getMonth()&&(o="53/1");const s=document.createElement("div");s.className="wnum-item",s.innerHTML=String(o),i.insertBefore(s,e)}}))}}}export{n as AmpPlugin};
