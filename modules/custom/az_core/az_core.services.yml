services:
  _defaults:
    autoconfigure: true
  az_core.page_cache_request_policy.deny_monitoring_page:
    class: Drupal\az_core\PageCache\DenyMonitoringPage
    arguments:
      - '@current_route_match'
    tags:
      - { name: page_cache_response_policy }
  logger.channel.az_core:
    parent: logger.channel_base
    arguments:
      - 'az_core'
  az_core.override_import:
    class: Drupal\az_core\AZConfigOverride
    arguments:
      - '@config.factory'
      - '@extension.list.module'
      - '@config_provider.collector'
      - '@config_sync.snapshotter'
      - '@config_update.config_list'
      - '@module_handler'
  cache.az_core_http_cache:
    class: Drupal\Core\Cache\CacheBackendInterface
    tags:
      - { name: cache.bin }
    factory: ['@cache_factory', 'get']
    arguments:
      - az_core_http_cache
  cache.az_core_http_cache_memory:
    class: Drupal\Core\Cache\MemoryCache\MemoryCacheInterface
    tags:
      - { name: cache.bin.memory, default_backend: cache.backend.memory.memory }
    factory: ['@cache_factory', 'get']
    arguments:
      - az_core_http_cache_memory
  cache.az_core_http_cache_chained:
    class: Drupal\Core\Cache\BackendChain
    calls:
      - [appendBackend, ['@cache.az_core_http_cache_memory']]
      - [appendBackend, ['@cache.az_core_http_cache']]
    tags: [{ name: cache.bin.memory }]
  az_core.guzzlecache_storage:
    class: Drupal\az_core\AZCoreGuzzleCacheStorage
    arguments:
      - '@cache.az_core_http_cache_chained'
  az_core.guzzlecache_strategy_polite:
    class: Drupal\az_core\Strategy\AZPoliteCacheStrategy
    arguments:
      - '@az_core.guzzlecache_storage'
      - 600
  az_core.az_migration_guzzlecache_middleware:
    class: Drupal\az_core\AZCoreGuzzleCacheMiddleware
    arguments: ['@config.factory','@az_core.guzzlecache_strategy_polite']
    tags:
      - { name: az_core_migration_http_client_middleware, priority: 0 }
  az_core.az_migration_http_retry_middleware:
    class: Drupal\az_core\AZCoreRetryMiddleware
    arguments:
      - 5
    tags:
      - { name: az_core_migration_http_client_middleware, priority: 100 }
  az_core.az_migration_http_handler_stack_configurator:
    class: Drupal\Core\Http\HandlerStackConfigurator
    arguments:
      - '@service_container'
    tags:
      - { name: service_id_collector, tag: az_core_migration_http_client_middleware }
  az_core.az_migration_http_handler_stack:
    class: GuzzleHttp\HandlerStack
    factory: GuzzleHttp\HandlerStack::create
    configurator: ['@az_core.az_migration_http_handler_stack_configurator', configure]
  az_core.az_migration_http_client_factory:
    class: Drupal\Core\Http\ClientFactory
    arguments:
      - '@az_core.az_migration_http_handler_stack'
  az_core.az_migration_http_client:
    class: GuzzleHttp\Client
    factory: ['@az_core.az_migration_http_client_factory', 'fromOptions']
