id: az_publication_bibtex_import
label: AZ Quickstart Publication BibTeX Import
migration_tags:
  - Publications
source:
  plugin: url
  data_fetcher_plugin: file
  data_parser_plugin: az_bibtex
  urls: []
  ids:
    citation_key:
      type: string
  fields:
    -
      name: _type
      selector: _type
    -
      name: citation_key
      selector: citation-key
    -
      name: title
      selector: title
    -
      name: author
      selector: author
    -
      name: publisher
      selector: publisher
    -
      name: institution
      selector: institution
    -
      name: school
      selector: school
    -
      name: location
      selector: location
    -
      name: volume
      selector: volume
    -
      name: pages
      selector: pages
    -
      name: number
      selector: number
    -
      name: booktitle
      selector: booktitle
    -
      name: journaltitle
      selector: journaltitle
    -
      name: journal
      selector: journal
    -
      name: annotation
      selector: annotation
    -
      name: abstract
      selector: abstract
    -
      name: url
      selector: url
    -
      name: doi
      selector: doi
    -
      name: version
      selector: version
    -
      name: datetype
      selector: _date_type
    -
      name: date
      selector: _date

process:
  type:
    plugin: default_value
    default_value: az_publication
  field_az_publication_type:
    plugin: static_map
    source: _type
    map:
      article: article-journal
      book: book
      booklet: pamphlet
      collection: collection
      conference: paper-conference
      inbook: book
      incollection: entry
      inproceedings: paper-conference
      manual: pamphlet
      mastersthesis: thesis
      misc: post
      online: webpage
      patent: patent
      periodical: periodical
      phdthesis: thesis
      proceedings: paper-conference
      report: report
      techreport: report
      thesis: thesis
      unpublished: manuscript
    default_value: article-journal
  title: title
  field_az_publication_date_type: datetype
  field_az_publication_date:
    plugin: format_date
    from_format: 'Y-m-d'
    to_format: 'Y-m-d'
    from_timezone: 'UTC'
    source: date
  field_az_publication_container:
    plugin: null_coalesce
    source:
      - booktitle
      - journaltitle
      - journal
  field_az_publication_abstract/value:
    plugin: null_coalesce
    source:
      - abstract
      - annotation
  field_az_publication_abstract/format:
    plugin: default_value
    default_value: az_standard
  field_az_publication_location: location
  field_az_publication_publisher:
    plugin: null_coalesce
    source:
      - publisher
      - institution
      - school
  field_az_publication_page: pages
  'field_az_publication_link/uri': url
  field_az_publication_doi: doi
  field_az_publication_volume: volume
  field_az_publication_issue: number
  field_az_publication_version: version
  field_az_authors:
    plugin: sub_process
    source: author
    process:
      fullname:
        -
          plugin: callback
          callable: array_filter
          source:
            - first
            - von
            - last
            - jr
        -
          plugin: concat
          delimiter: ' '
      target_id:
        plugin: entity_generate
        source: '@fullname'
        value_key: name
        ignore_case: true
        bundle: 1
        bundle_key: status
        entity_type: az_author
        values:
          field_az_author_fname: first
          field_az_author_nondrop_particle: von
          field_az_author_lname: last
          field_az_author_suffix: jr

destination:
  plugin: entity:node
  bundle: az_publication

dependencies:
  enforced:
    module:
      - az_publication
